<% const content = () => { %> 
<% const totalSales = orders.reduce((sum, o) => sum + o.total, 0); %>
<% const filterFrom = (typeof filters !== 'undefined' && filters && filters.from) ? filters.from : ''; %>
<% const filterTo = (typeof filters !== 'undefined' && filters && filters.to) ? filters.to : ''; %>
<div class="flex flex-col gap-6 animate-fade-in">
  <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
    <div>
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-brand/10 text-brand text-xs font-semibold uppercase tracking-wider w-max mb-2">
        Riwayat Transaksi
      </span>
      <h1 class="text-3xl font-semibold text-strong">Riwayat Orders</h1>
      <p class="text-sm text-muted mt-1">Pantau transaksi terbaru dan akses struk dengan mudah.</p>
    </div>
    <div class="glass-card inline-flex items-center gap-4 px-4 py-3" style="background: var(--surface-muted); border: 1px solid var(--border-soft);">
      <div>
        <p class="text-xs uppercase tracking-wider text-subtle">Total Order Ditampilkan</p>
        <p class="text-lg font-semibold text-strong"><%= orders.length %> transaksi</p>
      </div>
      <div class="h-10 w-px hidden md:block" style="background: var(--border-soft);"></div>
      <div>
        <p class="text-xs uppercase tracking-wider text-subtle">Nominal</p>
        <p class="text-lg font-semibold text-accent"><%= rupiah(totalSales) %></p>
      </div>
    </div>
  </div>

  <form class="glass-card px-4 py-4 flex flex-col md:flex-row md:items-end gap-4" method="get" action="/orders" style="background: var(--surface-muted); border: 1px solid var(--border-soft);">
    <div class="flex flex-col gap-2">
      <label class="text-xs uppercase tracking-wider text-subtle" for="from">Mulai</label>
      <input id="from" name="from" type="date" value="<%= filterFrom %>" class="input glass-input" />
    </div>
    <div class="flex flex-col gap-2">
      <label class="text-xs uppercase tracking-wider text-subtle" for="to">Selesai</label>
      <input id="to" name="to" type="date" value="<%= filterTo %>" class="input glass-input" />
    </div>
    <div class="flex gap-2 md:ml-auto">
      <button type="submit" class="glass-button inline-flex items-center gap-2 px-4 py-2 font-medium">
        Terapkan
      </button>
      <a href="/orders" class="glass-button alt inline-flex items-center gap-2 px-4 py-2 font-medium">
        Reset
      </a>
    </div>
  </form>

  <div class="glass-card overflow-hidden glass-table">
    <div class="overflow-x-auto px-4 pb-4">
      <table class="w-full text-sm glass-table">
        <thead class="text-xs uppercase tracking-wider text-muted">
          <tr>
            <th class="px-4 py-3 text-left">ID</th>
            <th class="px-4 py-3 text-left">Waktu</th>
            <th class="px-4 py-3 text-left kasir-cell">Kasir</th>
            <th class="px-4 py-3 text-left">Produk</th>
            <th class="px-4 py-3 text-left">Total</th>
            <th class="px-4 py-3 text-left">Pembayaran</th>
            <th class="px-4 py-3 text-left">Uang</th>
            <th class="px-4 py-3 text-left">Kembali</th>
            <th class="px-4 py-3 text-left">Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% orders.forEach(o => { const method = (o.payment_method || '').toLowerCase(); %>
            <tr class="transition">
              <td class="px-4 py-3 font-medium text-strong">#<%= o.id %></td>
              <td class="px-4 py-3 text-base"><%= dayjs(o.created_at).format('DD MMM YYYY HH:mm') %></td>
              <td class="px-4 py-3 text-base kasir-cell"><%= o.cashier || '-' %></td>
              <td class="px-4 py-3 text-sm text-muted"><%= o.product_summary ? o.product_summary : '-' %></td>
              <td class="px-4 py-3 font-semibold text-accent"><%= rupiah(o.total) %></td>
              <td class="px-4 py-3">
                <span class="inline-flex items-center px-2.5 py-1 text-xs font-medium badge-glass">
                  <%= method ? method.toUpperCase() : '-' %>
                </span>
              </td>
              <td class="px-4 py-3 text-base"><%= o.cash_received != null ? rupiah(o.cash_received) : '-' %></td>
              <td class="px-4 py-3 text-base"><%= o.change_amount != null ? rupiah(o.change_amount) : '-' %></td>
              <td class="px-4 py-3">
                <div class="flex flex-wrap items-center gap-2">
                  <a class="inline-flex items-center gap-1 px-3 py-1 rounded-lg font-medium transition glass-button" target="_blank" href="/orders/<%= o.id %>/receipt">
                    <span>Lihat Struk</span>
                  </a>
                  <a class="inline-flex items-center gap-1 px-3 py-1 rounded-lg font-medium transition glass-button alt" target="_blank" href="/orders/<%= o.id %>/receipt?print=1">
                    <span>Print</span>
                  </a>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<% } %>
<%- include('wrapper', { title: 'Orders', content }) %>
