<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Struk #<%= order.id %></title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --brand: #0EA5E9;
      --ink: #000;
    }
    @page { size: 58mm auto; margin: 0; }
    body {
      font-family: 'Poppins', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 11px;
      color: var(--ink);
      background: #fff;
      margin: 0;
      padding: 0;
    }
    .receipt { width: 58mm; margin: 0 auto; padding: 8px 10px; }
    .center { text-align: center; }
    table { width: 100%; font-size: 11px; border-collapse: collapse; }
    td { padding: 2px 0; }
    hr { border: 0; border-top: 1px dashed rgba(31,41,55,0.4); margin: 6px 0; }
    .brand-header {
      text-align: center;
      padding: 6px 0;
      border-radius: 8px;
      border: 1px solid rgba(14,165,233,0.35);
      background: linear-gradient(135deg, rgba(14,165,233,0.12), rgba(249,115,22,0.08));
    }
    .brand-header h3 {
      margin: 0;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }
    .muted { color: rgba(31,41,55,0.7); font-size: 10px; margin: 2px 0; }
    .totals td { font-weight: 600; }
    @media print {
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="receipt">
    <div class="brand-header">
      <h3><%= SHOP.name %></h3>
      <p class="muted"><%= SHOP.address %></p>
    </div>
    <p class="center muted" style="margin-top:6px;">
      Struk #<%= order.id %><br>
      <%= dayjs(order.created_at).format('DD MMM YYYY HH:mm') %><br>
      Kasir: <%= order.cashier %>
    </p>
    <hr>

    <!-- Detail item -->
    <table>
      <tbody>
        <% items.forEach(it => { %>
          <tr>
            <td><%= it.name %> x <%= it.qty %></td>
            <td style="text-align:right;"><%= rupiah(it.line_total) %></td>
          </tr>
        <% }) %>
      </tbody>
      <tfoot>
        <tr class="totals"><td>Total</td><td style="text-align:right;"><%= rupiah(order.total) %></td></tr>
        <tr><td>Metode</td><td style="text-align:right;"><%= (order.payment_method || '-').toUpperCase() %></td></tr>
        <% if (order.cash_received != null) { %>
          <tr><td>Dibayar</td><td style="text-align:right;"><%= rupiah(order.cash_received) %></td></tr>
          <tr><td>Kembali</td><td style="text-align:right;"><%= rupiah(order.change_amount) %></td></tr>
        <% } %>
      </tfoot>
    </table>
    <hr>

    <!-- Footer -->
    <p class="center muted"><%= SHOP.receipt_footer %></p>

    <!-- Tombol layar (tidak muncul saat print) -->
    <div class="no-print center" style="margin-top:8px;">
      <button onclick="window.print()" style="padding:6px 12px; background: var(--brand); color:#fff; border:none; border-radius:12px; cursor:pointer;">Print</button>
      <a href="/orders" style="margin-left:8px; color: var(--brand); text-decoration:none;">Kembali</a>
    </div>
  </div>

  <!-- Auto-print jika ada ?print=1 -->
  <script>
    (function () {
      const q = new URLSearchParams(location.search);
      if (q.get('print') === '1') {
        setTimeout(() => window.print(), 200);
      }
    })();
  </script>
</body>
</html>
